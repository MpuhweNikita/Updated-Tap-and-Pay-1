<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TAP & PAY</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="config.js"></script>
</head>

<body>
  <!-- Role Selection Popup -->
  <div id="role-selection-overlay" class="role-overlay">
    <div class="role-popup">
      <div class="role-popup-header">
        <h2>Welcome to TAP & PAY</h2>
        <p>Please select your role to continue</p>
      </div>
      <div class="role-options">
        <div class="role-card" data-role="admin">
          <div class="role-icon">ğŸ‘¨â€ğŸ’¼</div>
          <h3>Administrator</h3>
          <p>Full access to all features including system settings and configurations</p>
          <button class="role-select-btn">Select</button>
        </div>
        <div class="role-card" data-role="user">
          <div class="role-icon">ğŸ‘¤</div>
          <h3>Normal User</h3>
          <p>Access to top-up, marketplace, and transaction history</p>
          <button class="role-select-btn">Select</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Passcode Modal -->
  <div id="passcode-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content passcode-modal">
      <div class="modal-header">
        <h3 id="passcode-modal-title">Enter Passcode</h3>
        <button class="modal-close" id="passcode-modal-close">âœ•</button>
      </div>
      <div class="modal-body">
        <p id="passcode-modal-message">Enter your 6-digit passcode to authorize payment</p>
        <div class="passcode-input-container">
          <input type="text" class="passcode-digit" maxlength="1" data-index="0" inputmode="numeric" pattern="[0-9]" autocomplete="off" />
          <input type="text" class="passcode-digit" maxlength="1" data-index="1" inputmode="numeric" pattern="[0-9]" autocomplete="off" />
          <input type="text" class="passcode-digit" maxlength="1" data-index="2" inputmode="numeric" pattern="[0-9]" autocomplete="off" />
          <input type="text" class="passcode-digit" maxlength="1" data-index="3" inputmode="numeric" pattern="[0-9]" autocomplete="off" />
          <input type="text" class="passcode-digit" maxlength="1" data-index="4" inputmode="numeric" pattern="[0-9]" autocomplete="off" />
          <input type="text" class="passcode-digit" maxlength="1" data-index="5" inputmode="numeric" pattern="[0-9]" autocomplete="off" />
        </div>
        <div id="passcode-error" class="passcode-error" style="display: none;"></div>
      </div>
      <div class="modal-footer">
        <button id="passcode-cancel-btn" class="btn-secondary">Cancel</button>
        <button id="passcode-confirm-btn" class="btn-primary">Confirm</button>
      </div>
    </div>
  </div>

  <div class="dashboard">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title-row">
          <div>
            <h1>TAP & PAY</span></h1>
            <p class="sidebar-subtitle">Dashboard</p>
          </div>
          <div class="connection-indicator">
            <span class="indicator-dot" id="connection-indicator"></span>
          </div>
        </div>
      </div>

      <nav class="sidebar-nav">
        <a href="#" class="nav-item active" data-section="topup">
          <span class="nav-icon">ğŸ’³</span>
          <span class="nav-text">Top Up Card</span>
        </a>
        <a href="#" class="nav-item" data-section="marketplace">
          <span class="nav-icon">ğŸ›’</span>
          <span class="nav-text">Marketplace</span>
        </a>
        <a href="#" class="nav-item" data-section="history">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-text">Transactions</span>
        </a>
        <a href="#" class="nav-item" data-section="settings">
          <span class="nav-icon">âš™ï¸</span>
          <span class="nav-text">Settings</span>
        </a>
      </nav>

      <div class="sidebar-support">
        <div class="support-card">
          <div class="support-icon">ğŸ’¬</div>
          <h4>Need Help?</h4>
          <p>Get in touch with our support team for assistance.</p>
          <a href="mailto:byiringiroaloys8@gmail.com" class="support-link">
            <span>âœ‰ï¸</span> support@aloys.work
          </a>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Quick Stats Cards -->
      <div class="stats-grid">
        <div class="stat-card-main">
          <div class="stat-icon">ğŸ’³</div>
          <div class="stat-content">
            <div class="stat-label">Total Cards</div>
            <div class="stat-value" id="total-cards">0</div>
          </div>
        </div>
        <div class="stat-card-main">
          <div class="stat-icon">ğŸ“ˆ</div>
          <div class="stat-content">
            <div class="stat-label">Today's Transactions</div>
            <div class="stat-value" id="today-transactions">0</div>
          </div>
        </div>
        <div class="stat-card-main">
          <div class="stat-icon">ğŸ’°</div>
          <div class="stat-content">
            <div class="stat-label">Top-Up Volume</div>
            <div class="stat-value" id="total-volume">$0.00</div>
          </div>
        </div>
        <div class="stat-card-main">
          <div class="stat-icon">ğŸ›ï¸</div>
          <div class="stat-content">
            <div class="stat-label">Total Purchases</div>
            <div class="stat-value" id="total-payments">$0.00</div>
          </div>
        </div>
      </div>

      <!-- ===================== SECTION: TOP UP CARD ===================== -->
      <div id="section-topup" class="page-section active-section">
        <div class="section-header">
          <h2 class="section-title">ğŸ’³ Top Up Card</h2>
          <p class="section-subtitle">Scan your RFID card and add funds to your balance</p>
        </div>

        <div class="content-grid">
          <!-- Card Status -->
          <div class="glass-card card-status-section">
            <h3>Active Card</h3>
            <div class="card-visual-container">
              <div id="card-visual" class="card-visual">
                <div class="card-chip"></div>
                <div class="card-number">**** **** **** ****</div>
                <div class="card-details">
                  <div class="card-holder-group">
                    <span class="card-label">CARD HOLDER</span>
                    <span id="card-uid-display" class="card-value">NO CARD</span>
                  </div>
                  <div class="card-balance-group">
                    <span class="card-label">BALANCE</span>
                    <span id="card-balance-display" class="card-value">$0.00</span>
                  </div>
                </div>
              </div>
            </div>
            <div id="status-display" class="status-content">
              <div class="status-placeholder">Scan an RFID card to begin...</div>
            </div>
          </div>

          <!-- Top Up Form -->
          <div class="glass-card topup-section">
            <h3>Add Funds</h3>
            <div class="input-group">
              <label for="uid">Card UID</label>
              <input type="text" id="uid" placeholder="UID auto-populated on scan" readonly>
            </div>
            <div class="input-group">
              <label for="holderName">Card Holder Name</label>
              <input type="text" id="holderName" placeholder="Enter name for new cards">
            </div>
            
            <!-- Passcode setup for new cards -->
            <div id="new-card-passcode-section" class="new-card-passcode-section" style="display: none;">
              <label class="passcode-setup-label">ğŸ”’ Set Passcode (New Card)</label>
              <p class="passcode-setup-hint">Create a 6-digit passcode to secure your card</p>
              <div class="setup-passcode-container">
                <input type="password" class="setup-passcode-digit" maxlength="1" data-index="0" inputmode="numeric" pattern="[0-9]" />
                <input type="password" class="setup-passcode-digit" maxlength="1" data-index="1" inputmode="numeric" pattern="[0-9]" />
                <input type="password" class="setup-passcode-digit" maxlength="1" data-index="2" inputmode="numeric" pattern="[0-9]" />
                <input type="password" class="setup-passcode-digit" maxlength="1" data-index="3" inputmode="numeric" pattern="[0-9]" />
                <input type="password" class="setup-passcode-digit" maxlength="1" data-index="4" inputmode="numeric" pattern="[0-9]" />
                <input type="password" class="setup-passcode-digit" maxlength="1" data-index="5" inputmode="numeric" pattern="[0-9]" />
              </div>
              <div id="setup-passcode-error" class="setup-passcode-error" style="display: none;"></div>
            </div>
            
            <div class="quick-amounts">
              <button class="quick-amount-btn" data-amount="5">$5</button>
              <button class="quick-amount-btn" data-amount="10">$10</button>
              <button class="quick-amount-btn" data-amount="20">$20</button>
              <button class="quick-amount-btn" data-amount="50">$50</button>
            </div>
            <div class="input-group">
              <label for="amount">Custom Amount ($)</label>
              <input type="number" id="amount" placeholder="0.00" step="0.01">
            </div>
            <button id="topup-btn" class="topup-btn" disabled>
              <span class="btn-icon">ğŸ’³</span> Confirm Top Up
            </button>
            <button id="set-passcode-btn" class="set-passcode-btn" style="display: none;">
              <span class="btn-icon">ğŸ”’</span> Set Passcode
            </button>
          </div>
        </div>
      </div>

      <!-- ===================== SECTION: MARKETPLACE ===================== -->
      <div id="section-marketplace" class="page-section">
        <div class="section-header">
          <h2 class="section-title">ğŸ›’ Marketplace</h2>
          <p class="section-subtitle">Browse products and pay with your RFID card</p>
        </div>

        <div class="marketplace-layout">
          <!-- Product Grid -->
          <div class="glass-card marketplace-products">
            <div class="marketplace-header">
              <h3>Available Products</h3>
              <div class="cart-badge" id="cart-badge" style="display: none;">
                <span id="cart-count">0</span>
              </div>
            </div>
            
            <!-- Category Filter -->
            <div class="category-filter">
              <button class="category-btn active" data-category="all">All</button>
              <button class="category-btn" data-category="food">Food</button>
              <button class="category-btn" data-category="rwandan">ğŸ‡·ğŸ‡¼ Rwandan</button>
              <button class="category-btn" data-category="drinks">Drinks</button>
              <button class="category-btn" data-category="domains">Domains</button>
              <button class="category-btn" data-category="services">Services</button>
            </div>
            
            <div class="product-grid" id="product-grid">
              <!-- Products loaded dynamically -->
            </div>
          </div>

          <!-- Shopping Cart -->
          <div class="glass-card shopping-cart">
            <h3>ğŸ›ï¸ Shopping Cart</h3>
            <div id="cart-items" class="cart-items">
              <div class="cart-empty">
                <span class="cart-empty-icon">ğŸ›’</span>
                <p>Your cart is empty</p>
                <p class="cart-empty-hint">Click products to add them</p>
              </div>
            </div>
            <div class="cart-summary" id="cart-summary" style="display: none;">
              <div class="cart-summary-row">
                <span>Items</span>
                <span id="cart-total-items">0</span>
              </div>
              <div class="cart-summary-row cart-total-row">
                <span>Total</span>
                <span id="cart-total-price">$0.00</span>
              </div>
            </div>
            
            <!-- Passcode Input Section -->
            <div id="checkout-passcode-section" class="checkout-passcode-section" style="display: none;">
              <label class="passcode-label">ğŸ”’ Enter Passcode</label>
              <div class="inline-passcode-container">
                <input type="password" class="inline-passcode-digit" maxlength="1" data-index="0" inputmode="numeric" pattern="[0-9]" />
                <input type="password" class="inline-passcode-digit" maxlength="1" data-index="1" inputmode="numeric" pattern="[0-9]" />
                <input type="password" class="inline-passcode-digit" maxlength="1" data-index="2" inputmode="numeric" pattern="[0-9]" />
                <input type="password" class="inline-passcode-digit" maxlength="1" data-index="3" inputmode="numeric" pattern="[0-9]" />
                <input type="password" class="inline-passcode-digit" maxlength="1" data-index="4" inputmode="numeric" pattern="[0-9]" />
                <input type="password" class="inline-passcode-digit" maxlength="1" data-index="5" inputmode="numeric" pattern="[0-9]" />
              </div>
              <div id="inline-passcode-error" class="inline-passcode-error" style="display: none;"></div>
            </div>
            
            <div id="payment-status-msg" class="payment-status-msg"></div>
            <button id="checkout-btn" class="checkout-btn" disabled>
              <span class="btn-icon">ğŸ’³</span> Checkout & Pay
            </button>
            <p class="checkout-hint" id="checkout-hint">Scan your card first to enable checkout</p>
          </div>
        </div>
      </div>

      <!-- ===================== SECTION: TRANSACTION HISTORY ===================== -->
      <div id="section-history" class="page-section">
        <div class="section-header">
          <h2 class="section-title">ğŸ“Š Transaction History</h2>
          <p class="section-subtitle">View all top-ups and purchase records</p>
        </div>

        <div class="history-layout">
          <!-- Top-Up History -->
          <div class="glass-card history-panel">
            <div class="history-panel-header">
              <h3>ğŸ’° Top-Up History</h3>
              <span class="history-count" id="topup-count">0 records</span>
            </div>
            <div id="topup-history" class="transaction-list">
              <p class="empty-history">No top-up transactions yet</p>
            </div>
          </div>

          <!-- Purchase History -->
          <div class="glass-card history-panel">
            <div class="history-panel-header">
              <h3>ğŸ›ï¸ Purchase History</h3>
              <span class="history-count" id="purchase-count">0 records</span>
            </div>
            <div id="purchase-history" class="transaction-list">
              <p class="empty-history">No purchase transactions yet</p>
            </div>
          </div>
        </div>
      </div>

      <!-- ===================== SECTION: SETTINGS ===================== -->
      <div id="section-settings" class="page-section">
        <div class="section-header">
          <h2 class="section-title">âš™ï¸ Settings & System Info</h2>
          <p class="section-subtitle">Monitor system health, view statistics, and configuration details</p>
        </div>

        <div class="settings-layout">
          <!-- System Status Panel -->
          <div class="glass-card settings-panel">
            <h3>ğŸ”Œ System Status</h3>
            <div class="settings-status-grid">
              <div class="settings-status-card">
                <div class="settings-status-icon online" id="settings-mqtt-indicator"></div>
                <div class="settings-status-info">
                  <div class="settings-status-name">MQTT Broker</div>
                  <div class="settings-status-detail" id="settings-mqtt-status">Connecting...</div>
                </div>
              </div>
              <div class="settings-status-card">
                <div class="settings-status-icon online" id="settings-backend-indicator"></div>
                <div class="settings-status-info">
                  <div class="settings-status-name">Backend Server</div>
                  <div class="settings-status-detail" id="settings-backend-status">Connecting...</div>
                </div>
              </div>
              <div class="settings-status-card">
                <div class="settings-status-icon" id="settings-db-indicator"></div>
                <div class="settings-status-info">
                  <div class="settings-status-name">MongoDB Database</div>
                  <div class="settings-status-detail" id="settings-db-status">Unknown</div>
                </div>
              </div>
              <div class="settings-status-card">
                <div class="settings-status-icon" id="settings-ws-indicator"></div>
                <div class="settings-status-info">
                  <div class="settings-status-name">WebSocket</div>
                  <div class="settings-status-detail" id="settings-ws-status">Connecting...</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Overview Statistics -->
          <div class="glass-card settings-panel">
            <h3>ğŸ“ˆ Overview Statistics</h3>
            <div class="settings-stats-grid">
              <div class="settings-stat-card">
                <div class="settings-stat-icon">ğŸ’³</div>
                <div class="settings-stat-value" id="settings-total-cards">0</div>
                <div class="settings-stat-label">Registered Cards</div>
              </div>
              <div class="settings-stat-card">
                <div class="settings-stat-icon">ğŸ“Š</div>
                <div class="settings-stat-value" id="settings-total-transactions">0</div>
                <div class="settings-stat-label">Total Transactions</div>
              </div>
              <div class="settings-stat-card">
                <div class="settings-stat-icon">ğŸ’°</div>
                <div class="settings-stat-value" id="settings-topup-volume">$0.00</div>
                <div class="settings-stat-label">Top-Up Volume</div>
              </div>
              <div class="settings-stat-card">
                <div class="settings-stat-icon">ğŸ›ï¸</div>
                <div class="settings-stat-value" id="settings-purchase-volume">$0.00</div>
                <div class="settings-stat-label">Purchase Volume</div>
              </div>
              <div class="settings-stat-card">
                <div class="settings-stat-icon">ğŸ“…</div>
                <div class="settings-stat-value" id="settings-today-tx">0</div>
                <div class="settings-stat-label">Today's Transactions</div>
              </div>
              <div class="settings-stat-card">
                <div class="settings-stat-icon">ğŸ’µ</div>
                <div class="settings-stat-value" id="settings-net-balance">$0.00</div>
                <div class="settings-stat-label">Net Card Balance</div>
              </div>
            </div>
          </div>

          <!-- System Information -->
          <div class="glass-card settings-panel">
            <h3>ğŸ–¥ï¸ System Information</h3>
            <div class="settings-info-list">
              <div class="settings-info-row">
                <span class="settings-info-label">Application</span>
                <span class="settings-info-value">RFID Dashboard</span>
              </div>
              <div class="settings-info-row">
                <span class="settings-info-label">Version</span>
                <span class="settings-info-value">1.2.0</span>
              </div>
              <div class="settings-info-row">
                <span class="settings-info-label">Team ID</span>
                <span class="settings-info-value badge">niki_team</span>
              </div>
              <div class="settings-info-row">
                <span class="settings-info-label">Backend URL</span>
                <span class="settings-info-value mono" id="settings-backend-url">â€”</span>
              </div>
              <div class="settings-info-row">
                <span class="settings-info-label">MQTT Broker</span>
                <span class="settings-info-value mono">broker.benax.rw:1883</span>
              </div>
              <div class="settings-info-row">
                <span class="settings-info-label">Database</span>
                <span class="settings-info-value mono">MongoDB Atlas</span>
              </div>
              <div class="settings-info-row">
                <span class="settings-info-label">WebSocket</span>
                <span class="settings-info-value mono">Socket.IO v4.7.2</span>
              </div>
            </div>
          </div>

          <!-- MQTT Topics -->
          <div class="glass-card settings-panel">
            <h3>ğŸ“¡ MQTT Topic Configuration</h3>
            <div class="settings-info-list">
              <div class="settings-info-row">
                <span class="settings-info-label">Card Status</span>
                <span class="settings-info-value mono topic">rfid/niki_team/card/status</span>
              </div>
              <div class="settings-info-row">
                <span class="settings-info-label">Card Balance</span>
                <span class="settings-info-value mono topic">rfid/niki_team/card/balance</span>
              </div>
              <div class="settings-info-row">
                <span class="settings-info-label">Top-Up</span>
                <span class="settings-info-value mono topic">rfid/niki_team/card/topup</span>
              </div>
              <div class="settings-info-row">
                <span class="settings-info-label">Payment</span>
                <span class="settings-info-value mono topic">rfid/niki_team/card/payment</span>
              </div>
              <div class="settings-info-row">
                <span class="settings-info-label">Topic Prefix</span>
                <span class="settings-info-value mono badge">rfid/niki_team/</span>
              </div>
            </div>
          </div>
        </div>
      </div>

    </main>
  </div>
  <script src="app.js"></script>
</body>

</html>